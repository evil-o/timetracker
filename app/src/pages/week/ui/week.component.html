<ng-template #printPreview>
    <div class="modal-header">
        <h4 class="modal-title pull-left">Print preview...</h4>
        <button
            type="button"
            class="close pull-end"
            aria-label="Close"
            (click)="modalRef.hide()"
        >
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div
        class="modal-body"
        [innerHTML]="printPreviewContents"
        style="max-height: 500pt; overflow-y: scroll"
    ></div>
    <div class="modal-footer">
        <button type="button" class="btn btn-primary" (click)="savePrint()">
            Save
        </button>
        <button
            type="button"
            class="btn btn-secondary"
            (click)="modalRef.hide()"
        >
            Cancel
        </button>
    </div>
</ng-template>

<a id="printDownload" style="display: none"></a>

<nav aria-label="Week navigation">
    <ul class="nav">
        <li class="nav-item ms-auto">
            <ul class="pagination">
                <li class="page-item">
                    <a
                        class="page-link"
                        [routerLink]="[
                            '/week',
                            this.week!.year - 1,
                            this.week!.week,
                        ]"
                        aria-label="Previous year"
                    >
                        <span aria-hidden="true">&laquo;</span>
                        <span class="sr-only">Previous year</span>
                    </a>
                </li>
                <li class="page-item">
                    <a
                        class="page-link"
                        [routerLink]="[
                            '/week',
                            this.previousWeek!.year,
                            this.previousWeek!.week,
                        ]"
                        aria-label="Previous week"
                    >
                        <span aria-hidden="true">&lsaquo;</span>
                        <span class="sr-only">Previous week</span>
                    </a>
                </li>
                <li class="page-item disabled">
                    <a class="page-link" href="#" aria-label="Next week">
                        {{ week!.year }}, Week {{ week!.week }}
                    </a>
                </li>
                <li class="page-item">
                    <a
                        class="page-link"
                        [routerLink]="[
                            '/week',
                            this.nextWeek!.year,
                            this.nextWeek!.week,
                        ]"
                        aria-label="Next week"
                    >
                        <span aria-hidden="true">&rsaquo;</span>
                        <span class="sr-only">Next week</span>
                    </a>
                </li>
                <li class="page-item">
                    <a
                        class="page-link"
                        [routerLink]="[
                            '/week',
                            this.week!.year + 1,
                            this.week!.week,
                        ]"
                        aria-label="Next year"
                    >
                        <span aria-hidden="true">&raquo;</span>
                        <span class="sr-only">Next year</span>
                    </a>
                </li>
            </ul>
        </li>
        <li class="nav-item ms-auto">
            <button
                type="button"
                class="btn btn-secondary"
                (click)="openLargeModal(printPreview)"
            >
                <i class="fa fa-print"></i>
            </button>
        </li>
    </ul>
</nav>

<tabset>
    <tab
        heading="Weekly tally"
        [active]="selectedTab === 'tally'"
        (select)="selectedTab = 'tally'"
    >
        <div class="row mt-2">
            <div class="col">
                <div class="card w-100">
                    <div class="card-header text-right">
                        Total:
                        <app-hour-badge
                            data-testid="total-week-hours"
                            class="me-2"
                            [hours]="loggedSum$ | async"
                        ></app-hour-badge>
                    </div>
                    <div class="card-body">
                        <app-tally
                            [entries]="
                                (filteredLogEntries$ | async) ?? undefined
                            "
                            [activityTypes]="
                                (activityTypes$ | async) ?? undefined
                            "
                        ></app-tally>
                    </div>
                </div>
            </div>
        </div>
    </tab>
    <tab
        heading="Daily details"
        [active]="selectedTab === 'daily'"
        (select)="selectedTab = 'daily'"
    >
        <div class="row mt-2" *ngFor="let day of days$ | async">
            <div class="col">
                <div class="card">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-sm-1 text-right">
                                <span class="text-sm text-muted"
                                    >{{ day.date.getMonth() + 1 }}/{{
                                        day.date.getDate()
                                    }}</span
                                >
                            </div>
                            <div class="col-sm-2 pl-0">
                                <h5 class="card-title">
                                    {{ day.name }}
                                </h5>
                            </div>
                        </div>
                        <app-actvity-log-list
                            class="mt-2"
                            [groups$]="
                                day.entries$ | groupActivityLogEntriesById
                            "
                            [activityTypes$]="activityTypes$"
                        ></app-actvity-log-list>
                    </div>
                </div>
            </div>
        </div>
    </tab>
    <tab
        heading="Attendance"
        [active]="selectedTab === 'attendance'"
        (select)="selectedTab = 'attendance'"
    >
        <div class="row mt-2">
            <div class="col">
                <app-attendance-list
                    [attendances]="attendances$ | async"
                    [attendanceStats]="attendanceStats$ | async"
                ></app-attendance-list>
            </div>
        </div>
    </tab>
</tabset>
